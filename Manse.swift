//
//  Manse.swift
//  NextD-Day
//
//  Created by honggu on 2014. 9. 15..
//  Copyright (c) 2014년 honggu. All rights reserved.
//

import Foundation


class Manse {
	var akk:[Int] = [
	// 1841
	1,2,4,1,1,2,1,2,1,2,2,1,2,2,1,2,1,1,2,1,2,1,2,1,2,2,2,1,2,1,4,1,2,1,2,1,2,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,2,1,2,1,2,1,2,1,2,1,2,1,5,2,1,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,3,2,1,2,1,2,1,2,2,2,1,2,1,1,2,1,1,2,2,1,2,
	// 1851
	2,2,1,2,1,1,2,1,2,1,5,2,2,1,2,2,1,1,2,1,2,1,1,2,2,1,2,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,5,2,1,2,1,2,1,1,2,1,2,2,1,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,5,2,1,2,1,2,2,2,1,2,1,1,2,1,1,2,2,1,2,2,2,1,2,1,1,2,1,1,2,1,2,2,2,1,6,1,1,2,1,1,2,1,2,2,
	// 1861
	1,2,2,1,2,1,2,1,2,1,1,2,2,1,2,1,2,2,1,2,2,3,1,2,1,2,2,1,2,1,2,2,1,2,1,2,1,1,2,1,2,1,2,2,1,2,2,1,2,1,1,2,4,1,2,2,1,2,2,1,2,1,1,2,1,1,2,2,1,2,2,2,1,2,1,1,2,1,1,2,1,2,2,2,1,2,2,3,2,1,1,2,1,2,2,1,2,2,2,1,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,5,2,1,
	// 1871
	2,2,1,2,2,1,2,1,2,1,1,2,1,2,1,2,2,1,2,1,2,2,1,2,1,1,2,1,2,4,2,1,2,2,1,2,1,1,2,1,2,1,2,1,2,2,2,1,2,1,1,2,1,1,2,1,2,2,2,1,2,2,1,1,5,1,2,1,2,2,1,2,2,2,1,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,4,2,1,2,1,1,2,1,2,1,2,1,2,2,1,2,2,1,2,1,1,2,
	// 1881
	1,2,1,2,1,2,5,2,2,1,2,1,1,2,1,2,1,2,1,2,2,1,2,2,1,1,2,1,1,2,1,2,2,2,1,2,2,1,1,2,3,2,1,2,2,1,2,2,2,1,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,5,2,1,1,2,1,2,1,2,2,1,2,2,1,2,1,1,2,1,2,1,2,1,2,2,1,2,1,2,1,2,1,2,1,5,2,1,2,2,1,2,1,2,1,2,
	// 1891
	1,2,1,2,1,2,1,2,2,1,2,2,1,1,2,1,1,5,2,2,1,2,2,2,1,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,5,1,2,1,2,1,2,1,2,2,2,1,2,1,1,2,1,2,1,2,1,2,2,1,2,1,2,1,2,1,2,1,2,1,5,2,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,2,1,2,1,2,1,2,1,1,2,1,2,5,2,2,1,2,
	// 1901
	1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,3,2,1,1,2,2,1,2,2,2,1,2,1,1,2,1,1,2,2,1,2,2,1,2,2,1,1,2,1,2,1,2,1,2,2,4,1,2,1,2,1,2,1,2,1,2,1,2,1,2,2,1,2,1,2,1,2,1,1,2,2,1,2,1,2,2,1,2,1,5,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,
	// 1911
	2,1,2,1,1,5,1,2,2,1,2,2,2,1,2,1,1,2,1,1,2,2,1,2,2,2,1,2,1,1,2,1,1,2,1,2,2,2,1,2,5,1,2,1,2,1,1,2,2,1,2,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,2,1,2,1,2,1,2,3,2,1,2,2,1,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,5,2,2,1,2,2,1,2,1,1,2,1,1,2,2,1,2,2,
	// 1921
	2,1,2,1,1,2,1,1,2,1,2,2,2,1,2,2,3,2,1,1,2,1,2,2,1,2,2,1,2,1,2,1,2,1,1,2,2,1,2,1,2,2,1,2,1,2,1,1,2,1,2,5,2,1,2,2,1,2,1,2,1,1,2,1,2,1,2,2,1,2,2,1,2,1,1,2,1,2,1,2,2,1,2,2,1,5,1,2,1,1,2,2,1,2,2,2,1,2,1,1,2,1,1,2,1,2,2,2,1,2,2,1,1,5,1,2,1,2,2,1,
	// 1931
	2,2,2,1,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,1,6,1,2,1,2,1,1,2,1,2,1,2,2,1,2,2,1,2,1,2,1,1,2,1,2,1,2,2,1,2,2,1,2,1,4,1,2,1,2,1,2,2,2,1,2,1,1,2,1,1,2,1,2,2,2,1,2,2,1,1,2,1,4,1,2,2,1,2,2,2,1,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,
	// 1941
	2,2,1,2,2,4,1,1,2,1,2,1,2,1,2,2,1,2,2,1,2,1,1,2,1,2,1,2,1,2,2,1,2,2,1,2,1,1,2,4,1,2,1,2,2,1,2,2,1,1,2,1,1,2,1,2,2,2,1,2,2,1,1,2,1,1,2,1,2,2,1,2,2,5,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,3,2,1,2,1,2,2,1,2,2,1,2,1,1,2,1,2,1,
	// 1951
	2,1,2,2,1,2,1,2,1,2,1,2,1,2,1,2,4,2,1,2,1,2,1,2,1,2,1,1,2,2,1,2,2,1,2,2,1,1,2,1,1,2,1,2,2,1,2,2,2,1,4,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,5,2,1,2,2,1,2,2,1,2,1,1,2,1,2,1,2,1,2,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,5,2,1,2,1,2,1,
	// 1961
	2,1,2,1,2,1,2,2,1,2,1,2,1,2,1,1,2,1,2,2,1,2,2,1,2,1,2,3,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,1,2,2,1,2,2,5,2,1,1,2,1,1,2,2,1,2,2,1,2,2,1,1,2,1,2,1,2,1,2,2,1,2,1,5,2,1,2,1,2,1,2,1,2,1,2,2,1,2,1,2,1,2,1,1,2,2,1,2,1,2,2,1,2,
	// 1971
	1,2,1,1,5,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,1,2,2,2,1,2,2,1,5,1,2,1,1,2,2,1,2,2,2,1,2,1,1,2,1,1,2,1,2,2,2,1,2,1,2,1,5,2,1,1,2,2,1,2,2,1,2,1,2,1,2,1,1,2,2,1,2,1,2,2,1,2,1,2,1,2,1,1,2,1,6,1,2,2,1,2,1,2,1,1,2,1,2,1,2,2,1,2,2,
	// 1981
	1,2,1,1,2,1,1,2,2,1,2,2,2,1,2,3,2,1,1,2,2,1,2,2,2,1,2,1,1,2,1,1,2,1,2,2,2,1,2,2,1,1,2,1,1,5,2,2,1,2,2,1,2,1,2,1,1,2,1,2,1,2,2,1,2,2,1,2,1,2,1,1,2,1,2,2,1,5,2,2,1,2,1,2,1,1,2,1,2,1,2,2,1,2,2,1,2,1,1,2,1,2,1,2,2,1,2,2,1,2,1,1,5,1,2,1,2,2,2,2,
	// 1991
	1,2,1,1,2,1,1,2,1,2,2,2,1,2,2,1,1,2,1,1,2,1,2,2,1,2,5,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,1,2,2,1,5,2,1,1,2,1,2,1,2,2,1,2,1,2,2,1,2,1,1,2,1,2,1,2,2,1,2,2,1,2,1,1,2,3,2,2,1,2,2,2,1,2,1,1,2,1,1,2,1,2,2,2,1,2,2,1,1,2,1,1,2,1,2,2,1,
	// 2001
	2,2,2,3,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,1,2,2,1,2,1,1,2,1,2,1,5,2,2,1,2,1,2,2,1,1,2,1,2,1,2,1,2,2,1,2,2,1,2,1,1,2,1,2,1,5,2,2,1,2,2,1,1,2,1,1,2,1,2,2,2,1,2,2,1,1,2,1,1,2,1,2,2,1,2,2,2,1,1,5,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,
	// 2011
	2,1,2,2,1,2,1,1,2,1,2,1,2,1,6,2,1,2,1,1,2,1,2,1,2,1,2,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,5,2,1,2,1,2,1,1,2,1,2,2,2,1,2,2,1,1,2,1,1,2,1,2,2,1,2,2,2,1,1,2,3,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,1,2,5,2,1,1,2,1,2,1,2,
	// 2021
	1,2,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,2,1,2,1,2,1,2,1,5,2,1,2,1,2,2,1,2,1,2,1,2,1,1,2,1,2,2,1,2,2,1,2,1,2,1,1,5,2,1,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,1,2,2,2,1,2,2,1,5,1,2,1,1,2,2,1,2,2,1,2,2,1,1,2,1,1,2,2,1,2,1,2,2,1,2,1,2,1,2,1,
	// 2031
	2,1,5,2,1,2,2,1,2,1,2,1,2,1,1,2,1,2,2,1,2,2,1,2,1,2,1,1,2,1,5,2,2,2,1,2,1,2,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,2,1,1,2,2,1,2,2,2,1,2,1,4,1,1,2,1,2,2,2,2,1,2,1,1,2,1,1,2,1,2,2,2,1,2,1,2,1,2,1,1,2,1,2,2,1,2,5,2,1,2,1,2,1,1,2,1,2,2,1,2,2,1,2,1,2,1,
	// 2041
	2,1,1,2,1,2,2,1,2,2,1,2, // 41
	1,5,1,2,1,2,1,2,2,2,1,2, // 42
	1,2,1,1,2,1,1,2,2,1,2,2, // 43
	2,1,2,1,1,2,3,2,1,2,2,2, // 44
	2,1,2,1,1,2,1,1,2,1,2,2, // 45
	2,1,2,2,1,1,2,1,1,2,1,2, // 46
	2,1,2,2,4,1,2,1,1,2,1,2, // 47
	1,2,2,1,2,2,1,2,1,2,1,1, // 48
	2,1,2,1,2,2,1,2,2,1,2,1, // 49
	2,1,4,1,2,1,2,2,1,2,2,1 // 50
	];
	var isYoon:Bool
	var YoonYN:Int
	var amd:[Int]
	var ly:Int,lm:Int,ld:Int // 전해온 음력 인자값을 저장할 년, 월, 일 임시변수
	var sy:Int,sm:Int,sd:Int // 계산된 양력 년, 월, 일을 저장할 변수
	
	init()
	{
		amd = [Int](count: 12, repeatedValue:0)
		isYoon = false;
		YoonYN = 0;
		ly = 0; lm = 0; ld = 0
		sy = 0; sm = 0; sd = 0 // 계산된 양력 년, 월, 일을 저장할 변수
		initMoon()
	}
	
	func Sol2Lun(var y:Int,var m:Int, var d:Int)->Int
	{
		isYoon = true;
		var dt:[Int]					// 매년의 음력일수를 저장할 배열 변수
		var dtlength:Int
		var td:Int						// 음력일을 계산하기 위해 양력일과의 차이를 저장할 변수
		var td1:Int					// 1840년까지의 날수
		var td2:Int					// 현재까지의 날수
		var sy:Int, sm:Int, sd:Int				// 전해온 양력 인자값을 저장할 년, 월, 일 임시변수
		var mm:Int = 0					// 임시변수
	
		var m1:Int = 0, m2:Int = 0;
	
	
		td1 = 672069				// 672069 = 1840 * 365 + 1840/4 - 1840/100 + 1840/400 + 23  //1840년까지 날수
		sy = y
		sm = m
		sd = d
	
		siYoon(sy)
	
		if YoonYN == 1
		{
			amd[1]=29
		}
		else
		{
			amd[1]=28
		}
	
	
		// 1841년부터 작년까지의 날수
		td2 = (sy - 1) * 365 + ((sy - 1)/4) - ((sy - 1)/100) + ((sy - 1)/400);
	
		// 전월까지의 날수를 더함
	
	
		for var i:Int = 0 ; i <= sm - 2 ; i++
		{
			td2 = td2 + amd [i]
		}
	
		// 현재일까지의 날수를 더함
		td2 = td2 + sd;
	
		// 양력현재일과 음력 1840년까지의 날수의 차이
		td = td2 - td1 + 1;
	
		// 1841년부터 음력날수를 계산
		dtlength = sy - 1841;
	
	
		dt = [Int](count:dtlength+1, repeatedValue:0)
	
		for var i = 0 ; i <= sy - 1841; i++
		{
			dt[i] = 0
		
			for var j = 0  ; j <= 11; j++
			{
				switch (akk[i*12 + j])
				{
					case 1 :
						mm = 29
					case 2 :
						mm = 30
					case 3 :
						mm = 58	// 29 + 29
					case 4 :
						mm = 59	// 29 + 30
					case 5 :
						mm = 59	// 30 + 29
					case 6 :
						mm = 60	// 30 + 30
					default:
						continue
				}
				var intdt:Int  = dt[i];
	
				dt[i] = intdt + mm;
			}
		}
	
		// 1840년 이후의 년도를 계산 - 현재까지의 일수에서 위에서 계산된 1841년부터의 매년 음력일수를 빼가면수 년도를 계산
		ly = 0;
	
		while td > dt[ly]
		{
			td = td - dt[ly]
			ly = ly + 1
		}
	
	
		lm = 0;
	
		while(isYoon)
		{
			if (akk[ly*12 + lm] <= 2)
			{
				mm = (akk[ly*12 + lm]) + 28;
				if (td > mm)
				{
					td = td - mm;
					lm = lm + 1;
				}
				else
				{
					isYoon	= false;
					break;
				}
			}
			else
			{
				switch(akk[ly * 12 + lm])
				{
					case 3 :
						m1 = 29;
						m2 = 29;
					case 4 :
						m1 = 29;
						m2 = 30;
					case 5 :
						m1 = 30;
						m2 = 29;
					case 6 :
						m1 = 30;
						m2 = 30;
					default:
						continue
				}
		
				if (td > m1)
				{
					td = td - m1;
					if (td > m2)
					{
						td = td - m2;
						lm = lm + 1;
					}
					else
					{
						//윤달
					}
				}
				else
				{
					isYoon	= false;
					break;
				}
			}
		}
	
		ly = ly + 1841;
		lm = lm + 1;
		ld = td;
		
		return ly*10000+lm*100+ld;
	}
	
	// ------------------------------------------
	// 음력을 앙력으로 변경 함수
	// ------------------------------------------
	func Lun2Sol(var y:Int,var m:Int,var d:Int)->Int
	{
		
		
		var y1:Int,m1:Int,y2:Int,y3:Int // 임시변수
		var leap:Int
		var td:Int
	
		ly = y
		lm = m
		ld = d
	
		y1 = ly - 1841;
		m1 = lm - 1;
		leap = 0;
	
		if(akk[y1 * 12 + m1] > 2)
		{
			siYoon(ly);
			leap = YoonYN;
		}
	
		td = 0;
		for var i:Int = 0; i <= y1 - 1 ; i++
		{
			for var j = 0; j <= 11 ; j++
			{
				switch(akk[i * 12 + j])
				{
					case 1:
						td = td + 29
					case 2:
						td = td + 30;
					case 3:
						td = td + 58;
					case 4:
						td = td + 59;
					case 5:
						td = td + 59;
					case 6:
						td = td + 60;
					default:
						continue
				}
			}
		}
	
		for var j:Int = 0; j <= m1 - 1 ; j++
		{
			switch(akk[y1 * 12 + j])
			{
				case 1:
					td = td + 29;
				case 2:
					td = td + 30;
				case 3:
					td = td + 58;
				case 4:
					td = td + 59;
				case 5:
					td = td + 59;
				case 6:
					td = td + 60;
				default:
					continue
			}
		}
	
		td = td + ld + 22;
	
		y1 = 1840
		y2 = 0
		while(true)
		{
			y1 = y1 + 1;
			siYoon(y1);
			leap = YoonYN;
	
			if leap == 1
			{
				y2 = 366
			}
			else
			{
				y2 = 365
			}
	
			if(td <= y2)
			{
				break
			}

			td = td - y2
		}
	
		sy = y1;
		amd[1] = y2 - 337;
		m1 = 0;
		while(true)
		{
			m1 = m1 + 1;
			if(td <= amd[m1 - 1])
			{
				break;
			}
			td = td - amd[m1 - 1];
		}
	
		sm = m1;
		sd = td;

		y3 = sy;
		td = y3 * 365 + (y3 / 4) - (y3 / 100) + (y3 / 400);
		for var i:Int = 0; i <= sm - 1 ; i++
		{
			td = td + amd[i];
		}
	
		td = td + sd;
	
		return y3 * 10000 + sm * 100 + sd;
	}
	
	
	func initMoon()
	{
		amd[0] = 31;
		amd[1] = 0;
		amd[2] = 31;
		amd[3] = 30;
		amd[4] = 31;
		amd[5] = 30;
		amd[6] = 31;
		amd[7] = 31;
		amd[8] = 30;
		amd[9] = 31;
		amd[10] = 30;
		amd[11] = 31;
	}
	
	func siYoon(var year:Int)
	{
		if(year % 4 != 0)
		{
			YoonYN = 0;
		}
		else if(year % 100 != 0)
		{
			YoonYN = 1;
		}
		else if(year % 400 != 0)
		{
			YoonYN = 0;
		}
		else
		{
			YoonYN = 1;
		}
		
	}
	
	
}
